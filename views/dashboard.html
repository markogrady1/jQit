<html>
<title>Dashboard</title>
<meta charset='utf-8'>

<script src="/js/external/jquery-1.11.3.min.js"></script>
<script src="/js/external/d3.v3.min.js"></script>
<script src="/js/external/tinysort.js"></script>
<script src="/js/external/scrilla.js"></script>
<script src="/js/config.js"></script>
<script src="/js/sortTable.js"></script>
<script src="/socket.io/socket.io.js"></script>
<link rel="stylesheet" href="https://code.jquery.com/ui/1.11.4/themes/smoothness/jquery-ui.css">
<script src="https://code.jquery.com/ui/1.11.4/jquery-ui.js"></script>
<link rel='stylesheet' href='/css/jqit.css' />
<script>

flagData = <%- JSON.stringify(flag) %>
attention = <%- JSON.stringify(attention) %>
teamFlag = <%- JSON.stringify(teamFlag) %>


var teamsJSONValues = <%- JSON.stringify(teamsJSONValues) %>
console.log(flagData, attention, teamFlag)
checkDashboardValues(flagData, teamFlag);

</script>
<body>

<% include partials/header.html %>
<div class="content-wrap">
<a href="/">Back</a>
<br><br><br>
    <div class="repo-dashboard-wrap">
        <h3 class="repo-dashboard-title">Repository Dashboard</h3>
<select name="dashboard-watch1" id="dashboard-watch1">
    <option value="title">Watch</option>
    <% for (var i = 0; i < compDoc.length; i++) {
    var targetedRepo = flag === null ? "" : flag.repository_target;
    if(compDoc[i].name === targetedRepo) { %>
                <option value="<%= compDoc[i].name %>" selected><%= compDoc[i].name %></option>
          <%  } else { %>
                <option value="<%= compDoc[i].name %>"><%= compDoc[i].name %></option>
           <% } %>
    <% } %>
</select>

<div>Issues increase limit: <span id="issue-slider-amount"></span></div>
<div id="issue-slider"></div>
<div>Pull Requests increase limit: <span id="pulls-slider-amount"></span></div>
<div id="pulls-slider"></div>
<input type="checkbox" id="receive-email" class="receive-email-chck">
<label for="receive-email">Receive Email</label>
<br>
<input type="checkbox" id="flag-issues-chart" class="flag-pulls-chart-chck">
<label for="flag-issues-chart">Flag issues increase in chart</label>
<br>
<input type="checkbox" id="flag-pulls-chart" class="flag-issues-chart-chck">
<label for="flag-pulls-chart">Flag pull requests increase in chart</label>
<br>
<script>

</script>
<div class="radio-highlight-choice">
    <input class="highlight-choice" id="highlight-every-choice" type="checkbox" name="highlight-option" value="every-increase">
    <label  class="radio-label" for="highlight-every-choice">Highlight every increase</label>
</div>
<div class="dashboard-ajax-btn">Save</div>
<div class="feedback"></div>
    </div>












    <div class="team-dashboard-wrap">
        <h3 class="team-dashboard-title">Team Dashboard</h3>

        <select name="dashboard-watch2" id="dashboard-watch2">
            <option value="title">Watch</option>
            <% for (var i = 0; i < teamsJSONValues.length; i++) {
            var targetedRepo = teamFlag === null ? "" : teamFlag.team_target;
            if(teamsJSONValues[i].team === targetedRepo) { %>
            <option value="<%= compDoc[i].name %>" selected><%= teamsJSONValues[i].team %></option>
            <%  } else { %>
            <option value="<%= compDoc[i].name %>"><%= teamsJSONValues[i].team %></option>
            <% } %>
            <% } %>
        </select>

        <div>Issues increase limit: <span id="issue-slider-amount2"></span></div>
        <div id="issue-slider2"></div>
        <div class="ui-slider-tick-mark"></div>
        <div>Pull Requests increase limit: <span id="pulls-slider-amount2"></span></div>
        <div id="pulls-slider2"></div>
        <input type="checkbox" id="receive-email2" class="receive-email-chck2">
        <label for="receive-email2">Receive Email</label>
        <br>
        <input type="checkbox" id="flag-issues-chart2" class="flag-pulls-chart-chck2">
        <label for="flag-issues-chart2">Flag issues increase in chart</label>
        <br>
        <input type="checkbox" id="flag-pulls-chart2" class="flag-issues-chart-chck2">
        <label for="flag-pulls-chart2">Flag pull requests increase in chart</label>
        <br>
        <script>

        </script>
        <div class="radio-highlight-choice2">
            <input class="highlight-choice2" id="highlight-every-choice2" type="checkbox" name="highlight-option2" value="every-increase">
            <label  class="radio-label2" for="highlight-every-choice2">Highlight every increase</label>
        </div>
        <div class="dashboard-ajax-btn2">Save</div>
        <div class="feedback2"></div>

    </div>



















    </div>


<script>
    //incoming values for setting checkboxes
    if(receiveEmail === "true"){
        $("#receive-email").attr("checked", true);
    }
    if(highlightissueschart === "true"){
        $("#flag-issues-chart").attr("checked", true);
    }
    if(highlightpullschart === "true"){
        $("#flag-pulls-chart").attr("checked", true);
    }
    if(showeveryincrease === "true") {
        $("#highlight-every-choice").attr("checked", true);
    }


    if(teamreceiveEmail === "true"){
        $("#receive-email2").attr("checked", true);
    }
    if(teamhighlightissueschart === "true"){
        $("#flag-issues-chart2").attr("checked", true);
    }
    if(teamhighlightpullschart === "true"){
        $("#flag-pulls-chart2").attr("checked", true);
    }
    if(teamshoweveryincrease === "true") {
        $("#highlight-every-choice2").attr("checked", true);
    }
</script>
<script>
    //function to handle the slider setup
    $(function() {
        sliderInit("#issue-slider", "#issue-slider-amount", issuesboundary);
        sliderInit("#pulls-slider", "#pulls-slider-amount", pullsboundary);
        sliderInit("#issue-slider2", "#issue-slider-amount2", teamissuesboundary);
        sliderInit("#pulls-slider2", "#pulls-slider-amount2", teampullsboundary);
    });
    $(window).on('load', function() {
        prepRadioBtns();
    });

    $('#flag-issues-chart').change(function(){
       prepRadioBtns();
    });

    $('#flag-pulls-chart').change(function(){
        prepRadioBtns();
    });

    $('#flag-issues-chart2').change(function(){
        prepRadioBtns();
    });

    $('#flag-pulls-chart2').change(function(){
        prepRadioBtns();
    });
    //ajax call for save settings
    $(".dashboard-ajax-btn").click(function() {
        $.ajax({
            method: "POST",
            url: "dashboard/edit/repo",
            data: {
                watchTarget: function() {
                    return $('#dashboard-watch1 :selected').text();
                },
                receiveEmail: function() {
                    return $("#receive-email").is(":checked") ? true : false;
                },
                flagIssuesChart: function() {
                    return $("#flag-issues-chart").is(":checked") ? true : false;
                },
                flagPullsChart: function() {
                    return $("#flag-pulls-chart").is(":checked") ? true : false;
                },
                issueSlider: $("#issue-slider-amount").html(),
                pullsSlider: $("#pulls-slider-amount").html(),
                showEveryIncrease: function() {
                    return $('#highlight-every-choice').is(":checked")? true : false;
                },
                watchTeamTarget: function() {
                    return $('#dashboard-watch2 :selected').text();
                },
                receiveTeamEmail: function() {
                    return $("#receive-email2").is(":checked") ? true : false;
                },
                flagTeamIssuesChart: function() {
                    return $("#flag-issues-chart2").is(":checked") ? true : false;
                },
                flagTeamPullsChart: function() {
                    return $("#flag-pulls-chart2").is(":checked") ? true : false;
                },
                issueTeamSlider: $("#issue-slider-amount2").html(),
                pullsTeamSlider: $("#pulls-slider-amount2").html(),
                showEveryTeamIncrease: function() {
                    return $('#highlight-every-choice2').is(":checked")? true : false;
                }
            }
        }).done(function(msg) {
            $(".dashboard-ajax-btn").html("Saved");
            setTimeout(function(){
                $(".dashboard-ajax-btn").html("Save");
            }, 1000);
        });
    });


//    $(".dashboard-ajax-btn2").click(function() {
//        $.ajax({
//            method: "POST",
//            url: "dashboard/edit/team",
//            data: {
//                watchTarget: function() {
//                    return $('#dashboard-watch2 :selected').text();
//                },
//                receiveEmail: function() {
//                    return $("#receive-email2").is(":checked") ? true : false;
//                },
//                flagIssuesChart: function() {
//                    return $("#flag-issues-chart2").is(":checked") ? true : false;
//                },
//                flagPullsChart: function() {
//                    return $("#flag-pulls-chart2").is(":checked") ? true : false;
//                },
//                issueSlider: $("#issue-slider-amount2").html(),
//                pullsSlider: $("#pulls-slider-amount2").html(),
//                showEveryIncrease: function() {
//                    return $('#highlight-every-choice2').is(":checked")? true : false;
//                }
//            }
//        }).done(function(msg) {
//            $(".dashboard-ajax-btn2").html("Saved");
//            setTimeout(function(){
//                $(".dashboard-ajax-btn2").html("Save");
//            }, 1000);
//        });
//    });

    function sliderInit(sliderElem, amountDisplay, boundary) {
        $( sliderElem).slider({
            range: "min",
            value: parseInt(boundary),
            min: 1,
            max: 20,
            step: 1,
            slide: function( event, ui ) {
                $( amountDisplay ).html(ui.value );
            },create: function( event, ui ) {
                console.log(event.target)
                setSliderTicks(event.target);
            },
        });
        $( amountDisplay).html($( sliderElem).slider( "value" ) );
    }

    function prepRadioBtns() {
        if($('#flag-pulls-chart').is(":checked") || $('#flag-issues-chart').is(":checked")){
            $(".highlight-choice").removeAttr('disabled');
            $(".radio-label").css({
                color:"#000"
            });
        }else{
            $(".highlight-choice").attr('disabled', 'disabled');
            $(".highlight-choice").attr("checked", false);
            $(".radio-label").css({
                color:"#a9a9a9"
            });
        }
        if($('#flag-pulls-chart2').is(":checked") || $('#flag-issues-chart2').is(":checked")){
            $(".highlight-choice2").removeAttr('disabled');
            $(".radio-label2").css({
                color:"#000"
            });
        }else{
            $(".highlight-choice2").attr('disabled', 'disabled');
            $(".highlight-choice2").attr("checked", false);
            $(".radio-label2").css({
                color:"#a9a9a9"
            });
        }
    }




    function setSliderTicks(el) {
        var $slider =  $(el);
        var max =  $slider.slider("option", "max");
        var min =  $slider.slider("option", "min");
        var spacing =  100 / (max - min);

        $slider.find('.ui-slider-tick-mark').remove();
        for (var i = 0; i < max-min ; i++) {

            $('<span class="ui-slider-tick-mark"></span>').css('left', (spacing * i) +  '%').appendTo($slider);
        }
    }

</script>
</div>

</body>
</html>