<!doctype html>
<html>
<head>
	<title>Issue Tracker</title>
  <meta charset='utf-8'>
	<link rel='stylesheet' href='/css/style.css' />
	<script src="/js/external/jquery-1.11.3.min.js"></script>
   <script src="/js/external/d3.v3.min.js"></script>
	 <script src="/js/external/tinysort.js"></script>
    <script src="/js/external/scrilla.js"></script>
    <script src="/js/sortTable.js"></script>
    <script src="/socket.io/socket.io.js"></script>
    <script>
        var socket = io();
    </script>

    <script>
      var cd = <%- JSON.stringify(pullsNo) %>
      var pd = <%- JSON.stringify(completeD) %>
      console.log(pd)
      pd.pop(pd.length-1)
    </script>
</head>
<body>
<header class='header'>
    <h1><%= header %></h1>
    <div class='login-seq'></div>
    <script>
        var user = localStorage.getItem('9d7g9d8a7g7dsaas0')
        var state = window.location.search;
        state = state.split('=');

        if(state[0] === '?state') {

            $('.login-seq').append("<a id=gitlogout class='git-log git-logout' href=logout>Logout</a><br><br><br><img class=avatar src=https://avatars.githubusercontent.com/u/"+state[state.length-2]+ "="+state[state.length-1]+">".toString())
            $('.login-seq').append("<div><a class='profile' href='profile'>yoyoyoyo</a></div>")
            var pathname = window.location.pathname;
            if(pathname !== '/')
                $('.git-log').remove()
            localStorage.setItem('9d7g9d8a7g7dsaas0', true)
            $('.git-log').attr('class', 'login-seq logout');
            $('.logout').on('click', function(){
                localStorage.setItem('9d7g9d8a7g7dsaas0', false)
            })

        } else {
            $('.login-seq').append('<a class=git-log href=https://github.com/login/oauth/authorize?<%= urlstate %>>Login with Github</a><br><br>'.toString())
            localStorage.setItem('9d7g9d8a7g7dsaas0', false)
            var pathname = window.location.pathname;
            if(pathname !== '/')
                $('.git-log').remove()
        }
    </script>
</header>
<div class="pie"></div>
<div class="body-wrap">
<!-- <a href='/register'>register</a> -->

<table class="props xmpl" id="xtable">
  <thead>
  <tr >
    <th class='head'>Name</th>
    <th class='head'>Issues</th>
    <th class='head'>PR's</th>
    <th class='head'>Forks</th>
    <th class='head'>Watchers</th>
    <th class='head github-head'>GitHub</th>
  </tr>
  </thead>
  <tbody>
    <% for (var i = 0; i < completeD.length; i++) {
        var calculatedIssues = completeD[i].issues - completeD[i].pulls
        calculatedIssues = calculatedIssues < 0 ? 0 : calculatedIssues
    %>
   <tr>
   <td > <a class='index-name-link' href=repo/details/<%= names[i] %>> <%- completeD[i].name%></a></td>
    <td ><%= calculatedIssues %></td>
    <td ><%- completeD[i].pulls%></td>
    <td><%- completeD[i].forks%></td>
    <td><%- completeD[i].watchers%></td>
    <td class='github-detail'><a class='index-github-link' target='_blank' href=<%- completeD[i].github_url%>> <%- completeD[i].github_url%></a></td>
  </tr>
<% } %> 
  </tbody>
</table>
<script>
    sortTable();
</script>

<div class="chart-area"></div>
<p><%= username %>
<div class="button-wrap">
<% for (var i = 0; i < names.length; i++) { %>
   <a href=repo/details/<%= names[i] %>><div class='open-issue-repo'><%= names[i] %><span class='issue-count' ><%= issuesNo[i] %></span></div></a>   
<% } %> 
</div>
<script>
var data = <%- JSON.stringify(completeDoc) %>

scroller.init();

    socket.on("user", function(socket) {
        console.log('user emitted')
    })
    $("#gitlogout").on("click", function() {
        socket.emit("logout-hit");
    })
</script>
</div>
</body>
</html>
