<!doctype html>
<html>
<head>
	<title>Issue Tracker</title>
    <meta charset='utf-8'>
    <link href='https://fonts.googleapis.com/css?family=Libre+Baskerville' rel='stylesheet' type='text/css'>
	<script src="/js/external/jquery-1.11.3.min.js"></script>
    <script src="/js/external/d3.v3.min.js"></script>
    <script src="/js/external/tinysort.js"></script>
    <script src="/js/external/scrilla.js"></script>
    <script src="/js/sortTable.js"></script>
    <script src="/socket.io/socket.io.js"></script>
    <link rel='stylesheet' href='/css/jqit.css' />
    <script>
        var socket = io();

        var cd = <%- JSON.stringify(pullsNo) %>
        var pd = <%- JSON.stringify(completeD) %>
        var flagData = <%- JSON.stringify(flagData) %>
        var attention = <%- JSON.stringify(attention) %>
        var username = <%- JSON.stringify(username) %>
        var teams = <%- JSON.stringify(teams) %>
        attention = attention === null ? "" : attention;
        console.log("Flag Data: " ,flagData);
/**
 * The pd variable contains all the data needed for each of the repositories
 * The values are set   out as the example below displays.
 *
 * forks: 16
 * github_url: "https://github.com/jquery/jquery.github.io"
 * issues: 0
 * name: "jquery.github.io"
 * pulls: "0"
 * watchers: 6
 *
 * **/
      pd.pop(pd.length-1)
    </script>
</head>
<body>
<% include partials/header.html %>
<div class="pie"></div>
<div class="body-wrap">
    <br>
    <a class="team-table-link" href="#team-table">Team table</a>
    <table class="props xmpl home-main-table" id="xtable">
      <thead>
      <tr >
        <th class="head">Name</th>
        <th class="head">Issues</th>
        <th class="head">PR's</th>
        <th class="head">Forks</th>
        <th class="head">Watchers</th>
        <th class="head github-head">GitHub</th>
      </tr>
      </thead>
      <tbody>
        <% for (var i = 0; i < completeD.length; i++) {
            var calculatedIssues = completeD[i].issues - completeD[i].pulls;
            calculatedIssues = calculatedIssues < 0 ? 0 : calculatedIssues;
            var targetedRepo = flagData === null ? "" : flagData.target;

           if(completeD[i].name === targetedRepo){ %>
                <tr class="flagged" id="flagged">
           <% } else { %>
                <tr>
           <% }  %>
            <td class="name"><a class="index-name-link" href=repo/details/<%= names[i] %>> <%- completeD[i].name%></a><span class="attention<%- i %>"></span></td>

            <td ><%= calculatedIssues %></td>
            <td ><%- completeD[i].pulls%></td>
            <td><%- completeD[i].forks%></td>
            <td><%- completeD[i].watchers%></td>
        <td class="github-detail"><a class="index-github-link" target="_blank" href=<%- completeD[i].github_url%>> <%- completeD[i].github_url%></a></td>
      </tr>
        <script>
            if (attention.target === <%- JSON.stringify(completeD[i].name) %>) {
                $(".attention<%- i %>").append("<img class='attention-tag <%- completeD[i].name%>' title='click to remove pin' src='img/attention_pin.png'/>")
            }
        </script>
    <% } %>

      </tbody>
    </table>


<p class="team-table-title">jQuery Team Table</p>
    <a name="team-table"></a>
    <table class="props xmpl team-table" id="xtable">
    <thead>
    <tr >
    <th class="head">Team</th>
    <th class="head">Responsibility</th>
    </tr>
    </thead>
    <tbody>

    <% for (var k = 0; k < teams.length; k++) { %>
    <tr>
        <td class="team-name"><a class="index-name-link"  href="jquery/team/<%- teams[k].team %>"><%- teams[k].team %></a></td>
        <td>
        <%  for (var j in teams[k].responsibility) { %>
            <a class="index-name-link"  href="repo/details/<%- teams[k].responsibility[j]%>"><%- teams[k].responsibility[j] %></a><br>
        <% } %>
        </td>
    </tr>
    <% } %>
    </tbody>
    </table>
<script>
    sortTable();
    if($(".attention-tag").length != 0) {

        $attPin = $(".attention-tag");
        $attPin.css({
            cursor: "pointer"
        })
        $attPin.on("click", function() {
            var el = this.className.split(" ")[1];
            $attPin.remove();
            $.ajax({
                method: "POST",
                url: "/remove-pin",
                data: {
                    repoName: el,
                    username: username
                }
            });
        });
    }

var data = <%- JSON.stringify(completeDoc) %>

scroller.init();

    socket.on("userStatus", function(socket) {
        console.log("socket", socket)
    });
$("index-name-link").on("click", function(socket) {

});
    $("#gitlogout").on("click", function() {
        socket.emit("logout-hit");
    });
</script>
</div>
</body>
</html>
